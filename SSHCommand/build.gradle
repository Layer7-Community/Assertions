/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java application project to get you started.
 * For more details take a look at the 'Building Java & JVM projects' chapter in the Gradle
 * User Manual available at https://docs.gradle.org/6.7/userguide/building_java_projects.html
 */

plugins {
    // Apply the application plugin to add support for building a CLI application in Java.
    id 'application'
}

repositories {
    // Use mavenCentral for resolving dependencies.
    mavenCentral()
    // Repo for IntelliJ dependencies
    maven {
        url "https://packages.jetbrains.team/maven/p/ij/intellij-dependencies"
    }
}

// JDK1.8 needed by javac2 7.0.3
sourceCompatibility = JavaVersion.VERSION_1_8
targetCompatibility = JavaVersion.VERSION_1_8

configurations {
    jetBrainsFormAntTask // compile swing ui built with jetbrains intellij form builder
}

dependencies {
    // Dependencies for javac2 ant task
    jetBrainsFormAntTask "com.intellij:forms_rt:7.0.3"
    jetBrainsFormAntTask "com.intellij:javac2:7.0.3"
    jetBrainsFormAntTask "org.jetbrains.intellij.deps:asm-all:9.1"
    jetBrainsFormAntTask "org.jetbrains.intellij.deps:jdom:2.0.6"

    implementation "com.intellij:forms_rt:7.0.3"
    implementation files('src/main/resources/lib/ganymed-ssh2-263.jar')
    // TODO: Copy layer7 jars to locations below
    implementation files('lib/com.l7tech/layer7-api-8.11.02.14811.jar')
    implementation files('lib/com.l7tech/layer7-gateway-common-11.0.00.14811.jar')
    implementation files('lib/com.l7tech/layer7-gui-11.0.00.14811.jar')
    implementation files('lib/com.l7tech/layer7-policy-11.0.00.14811.jar')
    implementation files('lib/com.l7tech/layer7-utility-11.0.00.14811.jar')
}

jar {
    archivesBaseName = 'SshCommandAssertion'

    manifest {
        attributes(
            'Implementation-Vendor': 'CA Technologies - A Broadcom Company'
        )
    }
}

tasks.withType(JavaCompile) {
    doLast {
        def javaClassesDir = project.sourceSets.main.java.classesDirectory.get()
        mkdir(javaClassesDir)
        project.ant.taskdef name: 'javac2', classname: 'com.intellij.ant.Javac2', classpath: project.configurations.jetBrainsFormAntTask.asPath
        project.ant.javac2 srcdir: project.sourceSets.main.java.srcDirs.join(':'),
                classpath: project.sourceSets.main.compileClasspath.asPath,
                destdir: javaClassesDir,
                source: project.sourceCompatibility,
                target: project.targetCompatibility,
                includeAntRuntime: false,
                debugLevel: 'lines,vars,source',
                debug: 'on',
                optimize: 'on'
    }
}
